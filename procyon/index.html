<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Procyon Sector Navigation Console</title>
    <script src="https://unpkg.com/panzoom@9.4.0/dist/panzoom.min.js"></script>
    <link rel="stylesheet" href="src/css/styles.css">
</head>
<body>
    <div class="console-frame">
        <div class="corner corner-tl"></div>
        <div class="corner corner-tr"></div>
        <div class="corner corner-bl"></div>
        <div class="corner corner-br"></div>
        
        <div class="console-header">
            <div class="console-title"><h1>Procyon Sector Navigation</h1></div>
            <div class="console-status">SYSTEM READY</div>
        </div>
        
        <div class="console-content">
            <div class="scan-line"></div>
            <div class="map-container" id="map-container">
                <!-- SVG will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Wait for panzoom to be available
        window.addEventListener('load', function() {
            // Load the SVG file
            fetch('assets/images/procyon-sector-map.svg')
                .then(response => response.text())
                .then(svgText => {
                    const mapContainer = document.getElementById('map-container');
                    mapContainer.innerHTML = svgText;
                    
                    // Get the SVG element
                    const svg = mapContainer.querySelector('svg');
                    
                    // Calculate the initial scale to fill the container
                    const bbox = svg.getBBox();
                    const containerWidth = mapContainer.clientWidth;
                    const containerHeight = mapContainer.clientHeight;
                    
                    // Calculate scale to fill the container while maintaining aspect ratio
                    const scaleX = containerWidth / bbox.width;
                    const scaleY = containerHeight / bbox.height;
                    const initialScale = Math.max(scaleX, scaleY) * 1.1; // Add 10% padding
                    
                    // Initialize panzoom with bounds
                    const instance = panzoom(svg, {
                        maxZoom: 8,
                        minZoom: initialScale, // Prevent zooming out beyond initial scale
                        bounds: true,
                        boundsPadding: 0.1,
                        zoomDoubleClickSpeed: 1,
                        smoothScroll: false,
                        zoomDoubleClick: true, // Enable double-click to zoom
                        zoomDoubleClickSpeed: 1.5 // Zoom factor for double-click
                    });

                    // Handle touch events
                    mapContainer.addEventListener('touchstart', instance.handleTouchStart);
                    mapContainer.addEventListener('touchmove', instance.handleTouchMove);
                    mapContainer.addEventListener('touchend', instance.handleTouchEnd);

                    // Handle mouse events
                    mapContainer.addEventListener('wheel', instance.zoomWithWheel);

                    // Add click handlers to interactive regions
                    svg.querySelectorAll('rect[id]').forEach(rect => {
                        rect.addEventListener('click', function(event) {
                            const id = this.getAttribute('id');
                            console.log('Clicked element ID:', id);
                            // Prevent zoom on click
                            event.stopPropagation();
                        });
                    });

                    // Center the map
                    const centerX = (containerWidth - bbox.width * initialScale) / 2;
                    const centerY = (containerHeight - bbox.height * initialScale) / 2;
                    
                    // Set initial transform
                    instance.transform({
                        scale: initialScale,
                        x: centerX,
                        y: centerY
                    });
                });
        });
    </script>
</body>
</html>
